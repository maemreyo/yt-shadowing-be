# YouTube Integration Module

This module provides integration with YouTube API for fetching videos, captions, and metadata suitable for language learning.

## Features

- Search YouTube videos with language learning filters
- Fetch video metadata and information
- Download and parse video captions/subtitles
- Validate videos for language learning suitability
- API quota management and tracking
- Caching for improved performance

## API Endpoints

### Search Videos
```
GET /api/youtube/search
Query Parameters:
  - query: string (required) - Search query
  - language: string - ISO 639-1 language code (default: 'en')
  - duration: string - 'short' | 'medium' | 'long'
  - maxResults: number - Max results (1-50, default: 20)
  - pageToken: string - Pagination token
  - orderBy: string - Sort order (default: 'relevance')
  - captionsRequired: boolean - Only videos with captions (default: true)

Response:
{
  "success": true,
  "data": {
    "videos": [...],
    "nextPageToken": "...",
    "totalResults": 100
  }
}
```

### Get Video Information
```
GET /api/youtube/video/:videoId
Query Parameters:
  - includeCaptions: boolean - Include caption info (default: true)
  - includeMetadata: boolean - Include full metadata (default: true)

Response:
{
  "success": true,
  "data": {
    "videoId": "abc123",
    "title": "...",
    "duration": 300,
    "suitabilityScore": 85,
    "difficultyLevel": 3,
    ...
  }
}
```

### Get Video Captions
```
GET /api/youtube/captions/:videoId
Query Parameters:
  - language: string - Language code (default: 'en')
  - format: string - 'json' | 'srt' | 'vtt' (default: 'json')
  - autoGenerated: boolean - Accept auto-generated (default: false)

Response:
{
  "success": true,
  "data": {
    "videoId": "abc123",
    "language": "en",
    "segments": [...],
    "fullText": "...",
    "wordCount": 500
  }
}
```

### Validate Video
```
POST /api/youtube/validate
Body:
{
  "videoId": "abc123",
  "checkCaptions": true,
  "checkDuration": true,
  "minDuration": 60,
  "maxDuration": 1200
}

Response:
{
  "success": true,
  "data": {
    "isValid": true,
    "videoId": "abc123",
    "issues": [],
    "recommendations": {...}
  }
}
```

## Configuration

Required environment variables:
```env
YOUTUBE_API_KEY=your-api-key
YOUTUBE_QUOTA_LIMIT=10000
```

## Quota Management

The module tracks YouTube API usage to prevent exceeding daily quotas:
- Search: 100 units per request
- Video details: 1 unit per video
- Captions: 50 units per request

Current quota usage is returned in response headers:
- X-YouTube-Quota-Used
- X-YouTube-Quota-Limit
- X-YouTube-Quota-Remaining

## Caching

Results are cached in Redis:
- Search results: 1 hour
- Video metadata: 24 hours
- Captions: 7 days

## Error Handling

Common errors:
- 400: Invalid request parameters
- 403: YouTube API quota exceeded
- 404: Video or captions not found
- 500: YouTube API error

## Dependencies

- googleapis: YouTube API v3 client
- youtube-captions-scraper: Fallback caption fetching
- Redis: Caching layer
- Prisma: Database ORM

## Testing

Run module tests:
```bash
pnpm test src/modules/youtube-integration
```

## Future Enhancements

- [ ] Support for playlists
- [ ] Automatic caption translation
- [ ] Video quality analysis
- [ ] Speech rate detection
- [ ] Content difficulty analysis using NLP
